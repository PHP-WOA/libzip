 CMakeLists.txt     |  5 ++++-
 lib/CMakeLists.txt | 14 ++++++--------
 2 files changed, 10 insertions(+), 9 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index e82cdfb..b190e0b 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -281,6 +281,9 @@ ENDIF()
 IF(MSVC)
 ADD_DEFINITIONS("-D_CRT_SECURE_NO_WARNINGS")
 ADD_DEFINITIONS("-D_CRT_NONSTDC_NO_DEPRECATE")
+IF(CMAKE_SIZEOF_VOID_P EQUAL 4)
+ADD_DEFINITIONS("-D_USE_32BIT_TIME_T=1")
+ENDIF(CMAKE_SIZEOF_VOID_P EQUAL 4)
 ENDIF(MSVC)
 
 if(WIN32)
@@ -334,7 +337,7 @@ SET(includedir \${prefix}/${CMAKE_INSTALL_INCLUDEDIR})
 IF(CMAKE_SYSTEM_NAME MATCHES BSD)
   SET(PKG_CONFIG_RPATH "-Wl,-R\${libdir}")
 ENDIF(CMAKE_SYSTEM_NAME MATCHES BSD)
-get_target_property(LIBS_PRIVATE zip LINK_LIBRARIES)
+get_target_property(LIBS_PRIVATE libzip_a LINK_LIBRARIES)
 foreach(LIB ${LIBS_PRIVATE})
   if(LIB MATCHES "^/")
     get_filename_component(LIB ${LIB} NAME_WE)
diff --git a/lib/CMakeLists.txt b/lib/CMakeLists.txt
index d5bf580..9e3467c 100644
--- a/lib/CMakeLists.txt
+++ b/lib/CMakeLists.txt
@@ -193,6 +193,7 @@ IF(HAVE_LIBBZ2)
 ENDIF()
 
 IF(HAVE_LIBLZMA)
+  add_compile_definitions(LZMA_API_STATIC)
   SET(LIBZIP_OPTIONAL_FILES ${LIBZIP_OPTIONAL_FILES} zip_algorithm_xz.c)
 ENDIF()
 
@@ -218,15 +219,12 @@ IF(HAVE_CRYPTO)
 )
 ENDIF()
 
-ADD_LIBRARY(zip ${LIBZIP_SOURCES} ${LIBZIP_EXTRA_FILES} ${LIBZIP_OPTIONAL_FILES} ${LIBZIP_OPSYS_FILES})
+SET(CMAKE_DEBUG_POSTFIX _debug)
 
-IF(SHARED_LIB_VERSIONNING)
-SET_TARGET_PROPERTIES(zip PROPERTIES VERSION 5.1 SOVERSION 5)
-ENDIF()
-
-
-TARGET_LINK_LIBRARIES(zip PRIVATE ${ZLIB_LIBRARIES} ${OPTIONAL_LIBRARY})
-INSTALL(TARGETS zip
+ADD_LIBRARY(libzip_a STATIC ${LIBZIP_SOURCES} ${LIBZIP_EXTRA_FILES} ${LIBZIP_OPTIONAL_FILES} ${LIBZIP_OPSYS_FILES})
+SET_TARGET_PROPERTIES(libzip_a PROPERTIES VERSION 5.1 SOVERSION 5 COMPILE_PDB_NAME_DEBUG libzip_a_debug)
+TARGET_LINK_LIBRARIES(libzip_a ${ZLIB_LIBRARY} ${OPTIONAL_LIBRARY})
+INSTALL(TARGETS libzip_a
   RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
   ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
   LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR})
